<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Food, Handled</title>

  <style>
    :root{
      --bg1:#0b1412;
      --bg2:#0f1b18;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.04);
      --stroke:rgba(255,255,255,.10);
      --ink:#eaf3ef;
      --muted:rgba(234,243,239,.72);
      --muted2:rgba(234,243,239,.55);
      --pill:rgba(95, 255, 196,.16);
      --green:#37e2a3;
      --green2:#29c98e;
      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --radius: 26px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 40% 20%, rgba(55,226,163,.18) 0%, rgba(55,226,163,0) 55%),
        radial-gradient(900px 600px at 75% 60%, rgba(55,226,163,.10) 0%, rgba(55,226,163,0) 55%),
        linear-gradient(160deg, var(--bg2), var(--bg1));
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: 18px 14px 26px;
    }

    .shell{
      width:min(920px, 100%);
      padding-top: 8px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin: 6px 6px 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:700;
      letter-spacing:.2px;
    }
    .dot{
      width:12px; height:12px; border-radius:999px;
      background: var(--green);
      box-shadow: 0 0 0 6px rgba(55,226,163,.10);
      opacity:.95;
    }

    .linkBtn{
      appearance:none;
      background: transparent;
      border: 1px solid var(--stroke);
      color: var(--muted);
      padding: 9px 12px;
      border-radius: 999px;
      font-weight:650;
      cursor:pointer;
    }
    .linkBtn:hover{ border-color: rgba(255,255,255,.18); color: var(--ink); }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.075), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
      overflow:hidden;
    }

    .wrap{
      max-width: 520px;
      margin: 0 auto;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: var(--pill);
      border: 1px solid rgba(55,226,163,.22);
      color: rgba(234,243,239,.88);
      font-weight: 700;
      font-size: 13px;
      letter-spacing:.2px;
      margin-bottom: 10px;
    }

    h1{
      font-size: 44px;
      line-height: 1.02;
      margin: 6px 0 8px;
      letter-spacing: -1px;
    }
    h2{
      font-size: 30px;
      line-height: 1.08;
      margin: 6px 0 8px;
      letter-spacing: -.6px;
    }

    .sub{
      color: var(--muted);
      font-size: 16px;
      line-height: 1.45;
      margin: 0 0 14px;
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 14px;
    }

    .btnPrimary{
      appearance:none;
      border: none;
      background: linear-gradient(135deg, var(--green), var(--green2));
      color: #072016;
      font-weight: 900;
      padding: 14px 18px;
      border-radius: 16px;
      cursor:pointer;
      box-shadow: 0 14px 30px rgba(55,226,163,.18);
      min-width: 210px;
    }
    .btnPrimary:active{ transform: translateY(1px); }

    .btnGhost{
      appearance:none;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: var(--ink);
      font-weight: 850;
      padding: 14px 18px;
      border-radius: 16px;
      cursor:pointer;
      min-width: 210px;
    }

    .btnSmall{
      appearance:none;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      color: var(--ink);
      font-weight: 800;
      padding: 12px 14px;
      border-radius: 16px;
      cursor:pointer;
    }

    .hint{
      color: var(--muted2);
      font-size: 14px;
      margin-top: 10px;
    }

    .section{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.08);
    }

    .choiceList{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin: 12px 0 0;
    }

    .choice{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 14px 14px;
    }
    .choiceTitle{
      font-weight: 900;
      font-size: 18px;
      margin-bottom: 4px;
    }
    .choiceMeta{
      color: var(--muted);
      font-weight: 700;
      letter-spacing:.1px;
    }

    .twoCol{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (min-width: 760px){
      .wrap{ max-width: 560px; }
      .twoCol{ grid-template-columns: 1fr 1fr; }
    }

    .panel{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 14px;
      min-height: 120px;
    }
    .panel h3{
      margin: 0 0 8px;
      font-size: 15px;
      color: rgba(234,243,239,.88);
      letter-spacing:.2px;
      text-transform: none;
    }
    ul{
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      line-height: 1.55;
      font-weight: 650;
    }

    details{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      border-radius: 18px;
      padding: 12px 14px;
    }
    summary{
      list-style:none;
      cursor:pointer;
      font-weight: 900;
      font-size: 16px;
    }
    summary::-webkit-details-marker{ display:none; }
    .detailsBody{
      margin-top: 10px;
      color: var(--muted);
      font-weight: 650;
      line-height: 1.6;
    }

    .tags{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .tag{
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: rgba(234,243,239,.76);
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 850;
      font-size: 13px;
    }

    .footerNote{
      text-align:center;
      color: rgba(234,243,239,.40);
      font-weight: 700;
      margin-top: 14px;
      font-size: 13px;
      letter-spacing:.2px;
    }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <div class="shell">
    <div class="topbar">
      <div class="brand"><span class="dot"></span> Food, Handled</div>
      <button class="linkBtn" id="btnResetTop">Start over</button>
    </div>

    <div class="wrap">
      <!-- S0 -->
      <section class="card" id="s0">
        <h1>You don’t have to think about food.</h1>
        <p class="sub">Tap once. Dinner shows up.</p>

        <div class="btnRow">
          <button class="btnPrimary" id="btnHandle">Handle my food</button>
          <button class="btnGhost" id="btnShowTonight">Show me tonight</button>
        </div>

        <p class="hint">No account. No setup. Nothing to remember.</p>
      </section>

      <!-- S1 Tonight -->
      <section class="card hidden" id="s1">
        <div class="pill">Tonight is handled</div>
        <h2>Tonight</h2>

        <div class="choice" id="tonightCard">
          <div class="choiceTitle" id="tonightTitle">—</div>
          <div class="choiceMeta" id="tonightMeta">—</div>
        </div>

        <div class="twoCol">
          <div class="panel">
            <h3>Do this</h3>
            <ul id="tonightDo"></ul>
          </div>
          <div class="panel">
            <h3>Not this</h3>
            <ul id="tonightNot"></ul>
          </div>
        </div>

        <div class="btnRow">
          <button class="btnSmall" id="btnSeeSet">See the meal set</button>
          <button class="btnPrimary" id="btnImGood">I’m good</button>
        </div>

        <p class="hint">You can stop here.</p>
      </section>

      <!-- S2 Meal Set -->
      <section class="card hidden" id="s2">
        <div class="pill">Small set</div>
        <h2>The meal set</h2>
        <p class="sub">Familiar food. Minimal cleanup. <b>No decisions.</b></p>

        <div class="choiceList" id="setList"></div>

        <div class="section">
          <p class="sub" style="margin-bottom:10px;">Same calm format. Different dinners.</p>

          <div class="btnRow">
            <button class="btnGhost" id="btnTryDifferent">Try different dinners</button>
            <button class="btnPrimary" id="btnBackTonight">Back to tonight</button>
          </div>

          <div class="btnRow" style="margin-top:10px;">
            <button class="btnSmall" id="btnNeedShop">If I need to shop</button>
          </div>

          <p class="hint">You can stop here.</p>
        </div>
      </section>

      <!-- S3 Grocery -->
      <section class="card hidden" id="s3">
        <div class="pill">Optional</div>
        <h2>What to buy</h2>
        <p class="sub">Stays closed unless you open it.</p>

        <details id="groceryDetails">
          <summary>Open grocery list (short)</summary>
          <div class="detailsBody" id="groceryBody"></div>
          <div class="tags" id="groceryTags"></div>
        </details>

        <div class="section">
          <h2 style="margin-top:6px;">That’s it.</h2>
          <p class="sub">Close the tab whenever.</p>

          <div class="btnRow">
            <button class="btnPrimary" id="btnHandleAgain">Handle my food</button>
            <button class="btnGhost" id="btnCopyLink">Copy link</button>
            <button class="btnSmall" id="btnBackSet">Back</button>
          </div>

          <p class="hint">You can stop here.</p>
        </div>
      </section>

      <div class="footerNote">Disposable UX prototype • hardcoded • GitHub Pages-ready</div>
    </div>
  </div>

<script>
/* ===========================
   20 DINNER MEALS (no eggs)
   =========================== */

const MEALS = [
  {
    id: "chicken-rice-bowl",
    title: "Chicken & rice bowl",
    meta: "≤15 min • pan + bowl • low cleanup",
    do: ["Heat chicken", "Add rice", "Add frozen veg", "Sauce it", "Eat"],
    not: ["No planning", "No recipe hunting", "No prep marathon", "No spiral"],
    ingredients: ["rotisserie chicken (or frozen chicken strips)", "microwave rice packets", "frozen mixed veggies", "salsa or hot sauce"]
  },
  {
    id: "salmon-salad",
    title: "Salmon + salad kit",
    meta: "≤15 min • pan/airfryer • 1 bowl",
    do: ["Cook salmon (or heat)", "Dump salad kit", "Add salmon", "Eat"],
    not: ["No chopping", "No sauces from scratch", "No extra dishes", "No decisions"],
    ingredients: ["salmon filets (fresh or frozen)", "bagged salad kit", "lemon (optional)"]
  },
  {
    id: "turkey-taco-bowls",
    title: "Turkey taco bowls",
    meta: "≤15 min • pan + bowl • repeatable",
    do: ["Brown turkey", "Add taco seasoning", "Add rice", "Top with salsa", "Eat"],
    not: ["No recipe scrolling", "No complex toppings", "No multi-pan chaos", "No stress"],
    ingredients: ["ground turkey", "taco seasoning", "microwave rice packets", "salsa", "shredded cheese (optional)"]
  },
  {
    id: "stirfry-bag",
    title: "Frozen stir-fry + protein",
    meta: "≤12 min • one pan • very low cleanup",
    do: ["Cook frozen stir-fry bag", "Add chicken/shrimp/tofu", "Sauce (packet)", "Eat"],
    not: ["No chopping", "No measuring", "No extra pans", "No thinking"],
    ingredients: ["frozen stir-fry bag", "pre-cooked chicken or shrimp (or tofu)"]
  },
  {
    id: "pasta-red-sauce",
    title: "Pasta + red sauce + protein",
    meta: "≤15 min • pot • comfort-simple",
    do: ["Boil pasta", "Warm sauce", "Add protein", "Eat"],
    not: ["No fancy recipes", "No hour-long simmer", "No perfection", "No stress"],
    ingredients: ["pasta", "jarred marinara", "frozen meatballs (or chicken)"]
  },
  {
    id: "chicken-caesar-wrap",
    title: "Chicken Caesar wraps",
    meta: "≤10 min • bowl + wrap • no stove",
    do: ["Mix salad kit + chicken", "Wrap it", "Eat"],
    not: ["No cooking", "No chopping", "No extra cleanup", "No decisions"],
    ingredients: ["bagged Caesar kit", "rotisserie chicken", "tortillas"]
  },
  {
    id: "sheetpan-sausage-veg",
    title: "Sausage + sheet-pan veggies",
    meta: "≤20 min • sheet pan • hands-off",
    do: ["Dump on pan", "Bake", "Eat"],
    not: ["No prep marathon", "No sauces", "No extra dishes", "No stress"],
    ingredients: ["pre-cooked chicken sausage", "frozen veggies (broccoli/peppers)", "olive oil (optional)"]
  },
  {
    id: "beans-rice-bowl",
    title: "Beans + rice + salsa bowl",
    meta: "≤8 min • microwave • cheap & filling",
    do: ["Microwave rice", "Add beans", "Add salsa", "Eat"],
    not: ["No cooking skills", "No chopping", "No mess", "No decisions"],
    ingredients: ["microwave rice packets", "canned black beans", "salsa", "shredded cheese (optional)"]
  },
  {
    id: "chicken-pesto-pasta",
    title: "Chicken pesto pasta",
    meta: "≤15 min • pot • comfort-fast",
    do: ["Boil pasta", "Add pesto", "Add chicken", "Eat"],
    not: ["No complex cooking", "No extra steps", "No stress", "No thinking"],
    ingredients: ["pasta", "jarred pesto", "pre-cooked chicken"]
  },
  {
    id: "shrimp-tacos",
    title: "Shrimp tacos (frozen shrimp)",
    meta: "≤12 min • pan • fun but easy",
    do: ["Cook shrimp", "Warm tortillas", "Add slaw/salsa", "Eat"],
    not: ["No long prep", "No complicated sauces", "No extra dishes", "No thinking"],
    ingredients: ["frozen shrimp", "tortillas", "bagged slaw or salad", "salsa"]
  },
  {
    id: "bbq-chicken-sweetpotato",
    title: "BBQ chicken + microwaved sweet potato",
    meta: "≤12 min • microwave • zero hassle",
    do: ["Microwave sweet potato", "Add chicken", "Add BBQ", "Eat"],
    not: ["No cooking", "No prep", "No cleanup", "No decisions"],
    ingredients: ["sweet potatoes", "rotisserie chicken", "BBQ sauce"]
  },
  {
    id: "burger-salad",
    title: "Burger patties + salad kit",
    meta: "≤15 min • pan/airfryer • simple",
    do: ["Cook patties", "Dump salad kit", "Eat together"],
    not: ["No bun drama", "No toppings bar", "No mess", "No stress"],
    ingredients: ["frozen burger patties (or turkey)", "bagged salad kit"]
  },
  {
    id: "rice-beef-broccoli",
    title: "Beef + broccoli + rice (shortcut)",
    meta: "≤15 min • pan + bowl • filling",
    do: ["Cook beef strips", "Add frozen broccoli", "Add rice", "Eat"],
    not: ["No chopping", "No sauces from scratch", "No extra dishes", "No decisions"],
    ingredients: ["beef strips (or steak-ums)", "frozen broccoli", "microwave rice packets", "teriyaki sauce (optional)"]
  },
  {
    id: "chili-shortcut",
    title: "Shortcut chili bowl",
    meta: "≤15 min • pot • big payoff",
    do: ["Warm chili", "Add topping (optional)", "Eat"],
    not: ["No long simmer", "No chopping", "No stress", "No thinking"],
    ingredients: ["canned chili (or premade)", "shredded cheese (optional)", "tortilla chips (optional)"]
  },
  {
    id: "rotisserie-veg-plate",
    title: "Rotisserie chicken + steam bag veg",
    meta: "≤10 min • microwave • ultra simple",
    do: ["Heat veg steam bag", "Serve chicken", "Eat"],
    not: ["No cooking", "No prep", "No mess", "No decisions"],
    ingredients: ["rotisserie chicken", "steam-in-bag veggies", "microwave rice packets (optional)"]
  },
  {
    id: "quesadilla-chicken",
    title: "Chicken quesadillas",
    meta: "≤12 min • pan • low effort",
    do: ["Add tortilla + cheese + chicken", "Toast", "Eat"],
    not: ["No complicated cooking", "No prep", "No dishes", "No stress"],
    ingredients: ["tortillas", "shredded cheese", "rotisserie chicken", "salsa (optional)"]
  },
  {
    id: "tuna-rice-bowl",
    title: "Tuna rice bowl",
    meta: "≤6 min • bowl • no stove",
    do: ["Microwave rice", "Add tuna", "Add sauce", "Eat"],
    not: ["No cooking", "No mess", "No thinking", "No extra dishes"],
    ingredients: ["microwave rice packets", "canned tuna", "mayo or soy sauce (optional)"]
  },
  {
    id: "chicken-fajita-bag",
    title: "Chicken fajita skillet (frozen peppers)",
    meta: "≤15 min • one pan • easy win",
    do: ["Cook chicken", "Add frozen peppers/onions", "Season", "Eat"],
    not: ["No chopping", "No complexity", "No stress", "No overthinking"],
    ingredients: ["chicken strips", "frozen peppers & onions", "tortillas (optional)", "salsa"]
  },
  {
    id: "ramen-upgrade",
    title: "Upgraded ramen (quick protein)",
    meta: "≤10 min • pot • warm & easy",
    do: ["Cook ramen", "Add protein", "Add veg", "Eat"],
    not: ["No gourmet attempt", "No extra dishes", "No stress", "No decisions"],
    ingredients: ["ramen", "frozen mixed veggies", "pre-cooked chicken (or tofu)"]
  },
  {
    id: "pizza-salad",
    title: "Pizza + salad kit (reality meal)",
    meta: "≤10 min • oven/airfryer • done",
    do: ["Heat pizza", "Dump salad kit", "Eat"],
    not: ["No guilt spiral", "No cooking", "No decisions", "No effort"],
    ingredients: ["frozen pizza", "bagged salad kit"]
  }
];

/* ===========================
   STATE + ROUTING
   =========================== */

const els = {
  s0: document.getElementById('s0'),
  s1: document.getElementById('s1'),
  s2: document.getElementById('s2'),
  s3: document.getElementById('s3'),

  btnResetTop: document.getElementById('btnResetTop'),
  btnHandle: document.getElementById('btnHandle'),
  btnShowTonight: document.getElementById('btnShowTonight'),
  btnSeeSet: document.getElementById('btnSeeSet'),
  btnImGood: document.getElementById('btnImGood'),
  btnTryDifferent: document.getElementById('btnTryDifferent'),
  btnBackTonight: document.getElementById('btnBackTonight'),
  btnNeedShop: document.getElementById('btnNeedShop'),
  btnHandleAgain: document.getElementById('btnHandleAgain'),
  btnCopyLink: document.getElementById('btnCopyLink'),
  btnBackSet: document.getElementById('btnBackSet'),

  setList: document.getElementById('setList'),
  tonightTitle: document.getElementById('tonightTitle'),
  tonightMeta: document.getElementById('tonightMeta'),
  tonightDo: document.getElementById('tonightDo'),
  tonightNot: document.getElementById('tonightNot'),

  groceryBody: document.getElementById('groceryBody'),
  groceryTags: document.getElementById('groceryTags'),
  groceryDetails: document.getElementById('groceryDetails'),
};

function showScreen(id){
  ['s0','s1','s2','s3'].forEach(k => els[k].classList.add('hidden'));
  els[id].classList.remove('hidden');
  location.hash = `#${id}`;
}

function todayKey(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${day}`;
}

/* Stable daily set, but allow "Try different dinners" without making it feel like planning. */
function getVariant(){
  const base = `${todayKey()}`;
  const v = Number(localStorage.getItem(`fh_variant_${base}`) || "0");
  return v;
}
function bumpVariant(){
  const base = `${todayKey()}`;
  const v = getVariant() + 1;
  localStorage.setItem(`fh_variant_${base}`, String(v));
  return v;
}

function mulberry32(a){
  return function() {
    var t = a += 0x6D2B79F5;
    t = Math.imul(t ^ t >>> 15, t | 1);
    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
    return ((t ^ t >>> 14) >>> 0) / 4294967296;
  }
}

function hashToSeed(str){
  let h = 2166136261;
  for (let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}

function pickSet(){
  const seedStr = `foodhandled:${todayKey()}:v${getVariant()}`;
  const seed = hashToSeed(seedStr);
  const rand = mulberry32(seed);

  // shuffle copy
  const arr = MEALS.slice();
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(rand() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }

  const set = arr.slice(0,3);
  localStorage.setItem(`fh_set_${todayKey()}`, JSON.stringify(set.map(x => x.id)));
  return set;
}

function getSet(){
  const raw = localStorage.getItem(`fh_set_${todayKey()}`);
  if (!raw) return pickSet();
  try{
    const ids = JSON.parse(raw);
    const set = ids.map(id => MEALS.find(m => m.id === id)).filter(Boolean);
    if (set.length === 3) return set;
    return pickSet();
  }catch{
    return pickSet();
  }
}

function pickTonight(set){
  // pick 1 of the 3 in a stable daily way (but changes when variant changes)
  const seedStr = `tonight:${todayKey()}:v${getVariant()}`;
  const seed = hashToSeed(seedStr);
  const rand = mulberry32(seed);
  const idx = Math.floor(rand() * set.length);
  const meal = set[idx];
  localStorage.setItem(`fh_tonight_${todayKey()}`, meal.id);
  return meal;
}

function getTonight(set){
  const raw = localStorage.getItem(`fh_tonight_${todayKey()}`);
  if (!raw) return pickTonight(set);
  const found = MEALS.find(m => m.id === raw);
  if (!found) return pickTonight(set);
  // If tonight isn't in current set (after reshuffle), just re-pick.
  if (!set.some(m => m.id === found.id)) return pickTonight(set);
  return found;
}

function renderSet(){
  const set = getSet();
  els.setList.innerHTML = "";
  set.forEach(m => {
    const div = document.createElement('div');
    div.className = "choice";
    div.innerHTML = `
      <div class="choiceTitle">${m.title}</div>
      <div class="choiceMeta">${m.meta}</div>
    `;
    els.setList.appendChild(div);
  });
}

function renderTonight(){
  const set = getSet();
  const meal = getTonight(set);

  els.tonightTitle.textContent = meal.title;
  els.tonightMeta.textContent = meal.meta;

  els.tonightDo.innerHTML = "";
  meal.do.forEach(x => {
    const li = document.createElement('li');
    li.textContent = x;
    els.tonightDo.appendChild(li);
  });

  els.tonightNot.innerHTML = "";
  meal.not.forEach(x => {
    const li = document.createElement('li');
    li.textContent = x;
    els.tonightNot.appendChild(li);
  });
}

function uniq(arr){
  return Array.from(new Set(arr));
}

function renderGrocery(){
  const set = getSet();
  const all = set.flatMap(m => m.ingredients || []);
  const items = uniq(all).slice(0, 14); // keep it short on purpose

  const coreLabel = `<div style="font-weight:900; margin-bottom:6px;">Core (from your set)</div>`;
  const list = `<ul>${items.map(i => `<li>${escapeHtml(i)}</li>`).join('')}</ul>`;

  const optional = `
    <div style="margin-top:10px; font-weight:900;">Quick add-ons (optional)</div>
    <ul>
      <li>bagged salad kit (for a “done” side)</li>
      <li>hot sauce / salsa / teriyaki</li>
      <li>frozen fruit (easy dessert)</li>
    </ul>
  `;

  els.groceryBody.innerHTML = coreLabel + list + optional;

  // tags (simple + reassuring)
  els.groceryTags.innerHTML = "";
  const tags = [
    `~${Math.min(items.length,14)} items`,
    `1 store`,
    `minimal waste`
  ];
  tags.forEach(t => {
    const span = document.createElement('span');
    span.className = "tag";
    span.textContent = t;
    els.groceryTags.appendChild(span);
  });

  // keep list closed unless opened
  els.groceryDetails.open = false;
}

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ===========================
   ACTIONS
   =========================== */

function startFlow(){
  // ensure set exists for today
  getSet();
  renderTonight();
  showScreen('s1');
}

function startOverHard(){
  // reset today's stuff only (keep minimal; no global wipes)
  localStorage.removeItem(`fh_set_${todayKey()}`);
  localStorage.removeItem(`fh_tonight_${todayKey()}`);
  localStorage.removeItem(`fh_variant_${todayKey()}`);
  showScreen('s0');
}

els.btnResetTop.addEventListener('click', startOverHard);

els.btnHandle.addEventListener('click', () => {
  // picking a set is "handled" for them
  getSet();
  renderTonight();
  showScreen('s1');
});

els.btnShowTonight.addEventListener('click', () => {
  getSet();
  renderTonight();
  showScreen('s1');
});

els.btnSeeSet.addEventListener('click', () => {
  renderSet();
  showScreen('s2');
});

els.btnImGood.addEventListener('click', () => {
  // end the flow gracefully
  showScreen('s0');
});

els.btnTryDifferent.addEventListener('click', () => {
  bumpVariant();
  localStorage.removeItem(`fh_set_${todayKey()}`);
  localStorage.removeItem(`fh_tonight_${todayKey()}`);
  renderSet();
});

els.btnBackTonight.addEventListener('click', () => {
  renderTonight();
  showScreen('s1');
});

els.btnNeedShop.addEventListener('click', () => {
  renderGrocery();
  showScreen('s3');
});

els.btnHandleAgain.addEventListener('click', () => {
  // feels like a reset, but still calm
  bumpVariant();
  localStorage.removeItem(`fh_set_${todayKey()}`);
  localStorage.removeItem(`fh_tonight_${todayKey()}`);
  getSet();
  renderTonight();
  showScreen('s1');
});

els.btnBackSet.addEventListener('click', () => {
  renderSet();
  showScreen('s2');
});

els.btnCopyLink.addEventListener('click', async () => {
  try{
    await navigator.clipboard.writeText(location.origin + location.pathname);
    els.btnCopyLink.textContent = "Copied";
    setTimeout(()=> els.btnCopyLink.textContent = "Copy link", 1100);
  }catch{
    els.btnCopyLink.textContent = "Copy failed";
    setTimeout(()=> els.btnCopyLink.textContent = "Copy link", 1100);
  }
});

/* ===========================
   INIT (hash-safe)
   =========================== */

(function init(){
  const hash = (location.hash || "").replace("#","");
  if (hash === "s1"){ renderTonight(); showScreen('s1'); return; }
  if (hash === "s2"){ renderSet(); showScreen('s2'); return; }
  if (hash === "s3"){ renderGrocery(); showScreen('s3'); return; }
  showScreen('s0');
})();
</script>
</body>
</html>
